# NOMOCMS API

CMS supports GraphQL API on `/_api` endpoind.
API can accept parameters via JSON, FormData or query string.
API Accepts GET and POST requests for both queries and mutations.

JSON Example:

```
POST /_api
{
  "query":"mutation($event:String!,$path:String!){ping(event:$event, path:$path)}",
  "variables:{
    "event":"pageview",
    "path":"/"
  }
}
```

Query string:

```
GET /_api?query=mutation%7Bping(event%3A%22pageview%22,path%3A%22%2F%22)%7D # /_api?query=mutation{ping(event:"pageview",path:"/")}
```

FormData example:

```
curl --request POST \
  --url http://localhost:8080/_api \
  --header 'Content-Type: multipart/form-data' \
  --header 'content-type: multipart/form-data; boundary=---011000010111000001101001' \
  --form 'query=mutation($event:String!,$path:String!){ping(event:$event, path:$path)}' \
  --form 'variables={"event":"pageview","path":"/"}'
```

In cases where both query string and parseable body provided body all arguments will be merged, with body arguments overrriding query string parameters with the same names:

## Responses

API always response with JSON.

## Errors

If the response was successful, the returned status code will reflect that (200 or 201).
In case of user input errors API will respond with the following structure:

```json
{
  "errors": [
    {
      "name": "title",
      "message": "Title is required"
    }
  ],
  "code": 400
}
```

Note: Response status code will be also set the same code

## Authorization

For endpoints, that require authorization, authentification token
must be provided as one of the following:

- Cookie `amp-access`
- Authorization header set to `Bearer <token>`
- Query parameter `rid`

Example:

```
GET /_api?rid=amp-OFsqR4pPKynymPyMmplPNMvxSTsNQob3TnK-oE3nwVT0clORaZ1rkeEz8xej-vV6
```

This token is either generated by the client and authorized during a login operation,
either generated by the server.

Client generated tokens should normally be constructed by AMP framework, but if API
calls are made outside of a browser environment it's recommended to let server
generate a token instead of providing one.
